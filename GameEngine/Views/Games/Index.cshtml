@using GameEngine.Settings
@model IEnumerable<Game>

<a asp-controller="Games" asp-action="Create" class="btn btn-info text-dark btn-lg">
    <i class="bi bi-plus-circle"></i>
    Add Game
</a>

@if (!Model.Any())
{
    <div class="alert alert-warning mt-5">
        <h4 class="alert-heading">No Games!</h4>
        <p class="mb-0">No games added yet.</p>
    </div>
}
else
{
    <!-- Search -->
    <div class="d-flex justify-content-center mt-3 mb-3">
        <form class="d-flex" role="search" method="get" asp-controller="Games" asp-action="Search">
            <input class="form-control me-2" type="search" name="gameName" placeholder="Search" />
            <button class="d-flex btn btn-outline-success align-items-center" type="submit">
                <i class="bi bi-search me-1"></i> Search
            </button>
        </form>
    </div>

    <div class="mt-3">
        <table class="table table-hover">
            <tbody>
                @foreach (var game in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex">
                                <div class="pe-4">
                                    <img src="@($"{FileSettings.ImagesPath}/{game.Cover}")" alt="@game.Name" style="max-width: 100px"/>
                                </div>
                                <div class="d-flex flex-column justify-content-center">
                                    <h4>@game.Name</h4>
                                    <h5 class="text-success">@game.Category.Name</h5>
                                </div>
                            </div>
                        </td>
                        <td class="align-middle">
                            <div class="d-flex justify-content-end me-5">
                                <a class="btn btn-warning rounded rounded-3 me-3" asp-action="Edit" asp-route-id="@game.Id">
                                    <i class="bi bi-pencil-fill"></i>
                                </a>
                                <a class="btn btn-danger rounded rounded-3 delete-link" asp-action="Delete" asp-route-id="@game.Id">
                                    <i class="bi bi-trash3"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}



@* Delete Alert *@

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".delete-link").forEach(link => {
            link.addEventListener("click", function (e) {
                e.preventDefault();

                const url = this.getAttribute("href"); // Razor already generated the correct URL

                Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#3085d6",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(url, {
                            method: 'DELETE'
                        }).then(res => {
                            if (res.ok) {
                                Swal.fire("Deleted!", "The game has been deleted.", "success")
                                    .then(() => {
                                        location.reload(); // Refresh the table
                                    });
                            } else {
                                Swal.fire("Error", "Something went wrong!", "error");
                            }
                        }).catch(err => {
                            Swal.fire("Error", "Server connection failed.", "error");
                        });
                    }
                });
            });
        });
    });
</script>